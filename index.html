<!DOCTYPE html>
<html lang="mr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑ ‡§∏‡§æ‡§∞‡§£‡•Ä - ‡§∏‡§®‡§æ‡§§‡§® ‡§∏‡§æ‡§ß‡§®‡§æ</title>
    <meta name="description"
        content="‡§∏‡§®‡§æ‡§§‡§® ‡§∏‡§Ç‡§∏‡•ç‡§•‡•á‡§ö‡•ç‡§Ø‡§æ ‡§∂‡§ø‡§ï‡§µ‡§£‡•Ä‡§µ‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑ ‡§®‡§ø‡§∞‡•ç‡§Æ‡•Ç‡§≤‡§® ‡§™‡•ç‡§∞‡§ï‡•ç‡§∞‡§ø‡§Ø‡•á‡§∏‡§æ‡§†‡•Ä ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§∏‡§æ‡§ß‡§®. ‡§ö‡•Å‡§ï‡§æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ, ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§ò‡•ç‡§Ø‡§æ ‡§Ü‡§£‡§ø ‡§∏‡•ç‡§µ‡§§‡§É‡§Æ‡§ß‡•Ä‡§≤ ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§Ö‡§®‡•Å‡§≠‡§µ‡§æ.">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- XLSX library removed from sync load to improve performance -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #efefef;
        }

        .nav-primary {
            background-color: #FFFFCB;
        }

        .nav-secondary {
            background-color: #D3EFFB;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Google Translate Hiding Elements */
        .goog-te-banner-frame.skiptranslate,
        .goog-te-gadget-icon,
        .goog-te-spinner-pos {
            display: none !important;
        }

        body {
            top: 0px !important;
        }

        #google_translate_element {
            height: 0;
            overflow: hidden;
            position: absolute;
        }

        .modal-overlay {
            background-color: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(4px);
        }

        .notranslate {
            translate: no;
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .nav-link.active-tab {
            border-bottom: 2px solid #fc3400;
            color: #fc3400;
        }

        /* Custom Multi-Select Dropdown */
        .multi-select-container {
            position: relative;
        }

        .multi-select-trigger {
            cursor: pointer;
            min-height: 42px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 4px;
            padding: 8px 12px;
        }

        .multi-select-placeholder {
            color: #94a3b8;
            font-size: 14px;
        }

        .selected-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background-color: #fee2e2;
            color: #991b1b;
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 11px;
            font-weight: 600;
        }

        .selected-badge button {
            background: none;
            border: none;
            color: #991b1b;
            cursor: pointer;
            padding: 0;
            font-size: 14px;
            line-height: 1;
        }

        .selected-badge button:hover {
            color: #7f1d1d;
        }

        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-top: 4px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 50;
            max-height: 320px;
            display: none;
            flex-direction: column;
        }

        .multi-select-dropdown.active {
            display: flex;
        }

        .multi-select-search {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .multi-select-search input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            outline: none;
        }

        .multi-select-search input:focus {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(254, 226, 226, 0.5);
        }

        .multi-select-options {
            overflow-y: auto;
            max-height: 240px;
        }

        .multi-select-group-label {
            padding: 8px 12px;
            font-size: 10px;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            background-color: #f8fafc;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .multi-select-option {
            padding: 10px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            transition: background-color 0.15s;
        }

        .multi-select-option:hover {
            background-color: #f8fafc;
        }

        .multi-select-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: #ef4444;
        }

        .multi-select-option label {
            cursor: pointer;
            flex: 1;
            user-select: none;
        }

        .multi-select-option.hidden {
            display: none;
        }

        /* Fix for tiiny.host banner blocking content on mobile */
        @media (max-width: 768px) {
            body {
                padding-bottom: 80px;
            }

            /* Move toast up slightly on mobile so it clears the banner */
            #toast {
                bottom: 70px !important;
            }
        }
    </style>
</head>

<body class="text-slate-900">
    <div id="google_translate_element"></div>
    <!-- Background Audio Element -->
    <!-- REPLACE 'your-song.mp3' WITH YOUR ACTUAL SONG FILE NAME OR URL -->
    <audio id="bgMusic" loop>
        <source src="Datta_T.mp3" type="audio/mp3">
    </audio>

    <!-- Top Navigation Bar -->
    <nav class="nav-primary border-b border-orange-100 py-4 px-6 sticky top-0 z-50 shadow-sm">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 group relative"
                title="‡§∂‡•ç‡§∞‡•Ä ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§¶‡§§‡•ç‡§§ ‡§®‡§æ‡§Æ‡§ú‡§™ ‡§ö‡§æ‡§≤‡•Ç/‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§≤‡•ã‡§ó‡•ã‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ">
                <!-- Audio Toggle Button -->
                <button id="audioBtn" class="p-2 rounded-full text-orange-800 hover:bg-orange-200/50 transition-colors"
                    aria-label="Toggle Music">
                    <!-- Muted Icon (Default) -->
                    <svg id="icon-muted" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                        <line x1="23" y1="9" x2="17" y2="15"></line>
                        <line x1="17" y1="9" x2="23" y2="15"></line>
                    </svg>
                    <!-- Playing/Volume Icon (Hidden) -->
                    <svg id="icon-playing" class="hidden" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                </button>
                <span id="audioLabel" class="text-xs font-bold text-orange-800">
                    ‡§∂‡•ç‡§∞‡•Ä ‡§ó‡•Å‡§∞‡•Å‡§¶‡•á‡§µ ‡§¶‡§§‡•ç‡§§
                </span>
            </div>
            <h1 class="text-2xl font-bold text-orange-800 tracking-wide uppercase notranslate">‡§∏‡§®‡§æ‡§§‡§® ‡§∏‡§æ‡§ß‡§®‡§æ</h1>
            <button id="menuBtn" class="p-2 hover:bg-orange-200/50 rounded-full transition-colors"
                aria-label="Open Menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" class="text-orange-800">
                    <circle cx="12" cy="12" r="1" />
                    <circle cx="12" cy="5" r="1" />
                    <circle cx="12" cy="19" r="1" />
                </svg>
            </button>
        </div>
    </nav>

    <!-- Sub Navigation Bar -->
    <nav class="nav-secondary border-b border-blue-100 sticky top-[65px] z-40 shadow-sm">
        <div class="max-w-6xl mx-auto overflow-x-auto hide-scrollbar flex justify-start md:justify-center">
            <ul
                class="flex items-center gap-8 px-6 py-3 whitespace-nowrap text-[11px] md:text-xs font-bold text-blue-800 uppercase tracking-wider">
                <li id="nav-wrong" class="nav-link cursor-pointer transition-colors pb-0.5 active-tab">‡§Ö‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§ï‡•É‡§§‡•Ä / ‡§¶‡•ã‡§∑
                </li>
                <li id="nav-decision" class="nav-link cursor-pointer transition-colors pb-0.5">‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø</li>
                <li id="nav-results" class="nav-link cursor-pointer transition-colors pb-0.5">‡§™‡§∞‡§ø‡§£‡§æ‡§Æ / ‡§∏‡§æ‡§ß‡•ç‡§Ø</li>
            </ul>
        </div>
    </nav>

    <!-- Options Modal -->
    <div id="settingsModal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div id="modalOverlay" class="absolute inset-0 modal-overlay"></div>
        <div
            class="bg-white w-full max-w-sm rounded-3xl shadow-2xl relative z-10 overflow-hidden transform scale-95 transition-transform duration-200">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-lg font-bold">‡§Æ‡•á‡§®‡•Ç</h3>
                <button id="closeModal" class="text-slate-400 hover:text-slate-600">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2.5">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="p-4 space-y-2">
                <div class="p-4 rounded-2xl bg-slate-50 border border-slate-100 mb-2">
                    <label for="langSelect" class="block text-[10px] font-bold text-slate-600 uppercase mb-2">‡§≠‡§æ‡§∑‡§æ
                        ‡§®‡§ø‡§µ‡§°‡§æ</label>
                    <select id="langSelect"
                        class="w-full bg-white border border-slate-200 rounded-xl p-3 text-sm outline-none font-medium">
                        <option value="mr" selected>‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                        <option value="en">English</option>
                        <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                        <option value="gu">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</option>
                        <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                        <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                    </select>
                </div>
                <button id="exportAllBtn"
                    class="w-full flex items-center gap-4 p-4 rounded-2xl hover:bg-slate-50 transition-colors text-slate-700 font-semibold text-sm">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    ‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡§æ (Excel)
                </button>
                <div class="mt-4 p-4 rounded-2xl bg-red-50 border border-red-100">
                    <h4 class="text-xs font-bold text-red-600 uppercase mb-2">‡§Æ‡§¶‡§§ ‡§Ü‡§£‡§ø ‡§Ö‡§≠‡§ø‡§™‡•ç‡§∞‡§æ‡§Ø</h4>
                    <p class="text-xs text-slate-700 mb-3 leading-relaxed font-medium">
                        ‡§ï‡§æ‡§π‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ø‡•á‡§§ ‡§Ü‡§π‡•á? ‡§à‡§Æ‡•á‡§≤‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§Ø‡§æ ‡•© ‡§∏‡•ã‡§™‡•ç‡§Ø‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡§æ‡§Ç‡§ö‡•Ä ‡§â‡§§‡•ç‡§§‡§∞‡•á ‡§¶‡•ç‡§Ø‡§æ:
                    </p>
                    <div class="text-[10px] space-y-2 text-slate-600 mb-4 bg-white p-3 rounded-xl border border-red-50">
                        <div>
                            <p class="font-bold text-slate-800">‡•ß. ‡§ï‡§æ‡§Ø ‡§Ö‡§°‡§ö‡§£ ‡§Ü‡§≤‡•Ä?</p>
                            <p class="text-[9px] text-slate-500">‡§â‡§¶‡§æ: "‡§∏‡•á‡§µ‡•ç‡§π ‡§¨‡§ü‡§® ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§ ‡§®‡§æ‡§π‡•Ä‡§Ø‡•á."</p>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">‡•®. ‡§ï‡•ã‡§£‡§§‡§æ ‡§´‡•ã‡§® / ‡§∏‡§Ç‡§ó‡§£‡§ï ‡§µ‡§æ‡§™‡§∞‡§§‡§æ‡§Ø?</p>
                            <p class="text-[9px] text-slate-500">‡§â‡§¶‡§æ: "‡§∏‡•Ö‡§Æ‡§∏‡§Ç‡§ó" ‡§ï‡§ø‡§Ç‡§µ‡§æ "‡§Ü‡§Ø‡§´‡•ã‡§®"</p>
                        </div>
                        <div>
                            <p class="font-bold text-slate-800">‡•©. ‡§∂‡§ï‡•ç‡§Ø ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§´‡•ã‡§ü‡•ã (Screenshot) ‡§ú‡•ã‡§°‡§æ</p>
                            <p class="text-[9px] text-slate-500 italic">‡§Ø‡§æ‡§Æ‡•Å‡§≥‡•á ‡§Ü‡§Æ‡•ç‡§π‡•Ä ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡•ß‡•¶ ‡§™‡§ü ‡§µ‡•á‡§ó‡§æ‡§®‡•á ‡§∏‡•ã‡§°‡§µ‡•Ç ‡§∂‡§ï‡§§‡•ã!</p>
                        </div>
                    </div>
                    <div class="flex flex-col gap-2">
                        <a href="mailto:mayurmyana111@gmail.com?subject=Problem Report - Sanatan App&body=Hello Mayur,%0A%0AI found an issue in the app:%0A%0A1. What happened? (‡§ï‡§æ‡§Ø ‡§ù‡§æ‡§≤‡•á?): %0A%0A2. I am using this phone/computer (‡§Æ‡•Ä ‡§π‡§æ ‡§´‡•ã‡§® ‡§µ‡§æ‡§™‡§∞‡§§ ‡§Ü‡§π‡•á): %0A%0A(Please attach a photo if possible / ‡§∂‡§ï‡•ç‡§Ø ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏ ‡§´‡•ã‡§ü‡•ã ‡§ú‡•ã‡§°‡§æ)%0A"
                            class="flex items-center justify-center gap-2 bg-red-600 text-white py-3 rounded-xl hover:bg-slate-900 font-bold text-xs transition-all shadow-md active:scale-95">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" />
                                <polyline points="22,6 12,13 2,6" />
                            </svg>
                            ‡§Æ‡•á‡§≤ ‡•≤‡§™‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§â‡§ò‡§°‡§æ
                        </a>
                        <a target="_blank"
                            href="https://mail.google.com/mail/?view=cm&fs=1&to=mayurmyana111@gmail.com&su=Problem%20Report%20-%20Sanatan%20App&body=Hello%20Mayur,%0A%0AI%20found%20an%20issue%20in%20the%20app:%0A%0A1.%20What%20happened?%20(‡§ï‡§æ‡§Ø%20‡§ù‡§æ‡§≤‡•á?):%20%0A%0A2.%20I%20am%20using%20this%20phone/computer%20(‡§Æ‡•Ä%20‡§π‡§æ%20‡§´‡•ã‡§®%20‡§µ‡§æ‡§™‡§∞‡§§%20‡§Ü‡§π‡•á):%20%0A%0A(Please%20attach%20a%20photo%20if%20possible%20/%20‡§∂‡§ï‡•ç‡§Ø%20‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§∏%20‡§´‡•ã‡§ü‡•ã%20‡§ú‡•ã‡§°‡§æ)%0A"
                            class="flex items-center justify-center gap-2 bg-white border border-slate-200 text-slate-700 py-3 rounded-xl hover:bg-slate-50 font-bold text-xs transition-all shadow-sm active:scale-95">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2.5">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                            </svg>
                            ‡§ï‡•ç‡§∞‡•ã‡§Æ ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§â‡§ò‡§°‡§æ
                        </a>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 p-4 text-center">
                <p class="text-[10px] text-slate-600 font-bold uppercase tracking-widest notranslate">‡§Ü‡§µ‡•É‡§§‡•ç‡§§‡•Ä 1.8.5</p>
            </div>
        </div>
    </div>

    <main>
        <!-- WRONG THINGS PAGE -->
        <div id="page-wrong" class="page-content active max-w-6xl mx-auto px-4 py-8">
            <header class="mb-8">
                <h2 class="text-2xl font-extrabold tracking-tight text-slate-900 notranslate">‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑ ‡§®‡•ã‡§Ç‡§¶</h2>
                <p class="text-slate-600 text-sm italic">"‡§Ü‡§§‡•ç‡§Æ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§π‡•á ‡§∂‡•Å‡§¶‡•ç‡§ß‡§§‡•á‡§ö‡•á ‡§™‡§π‡§ø‡§≤‡•á ‡§™‡§æ‡§ä‡§≤ ‡§Ü‡§π‡•á."</p>
            </header>
            <div class="grid lg:grid-cols-12 gap-8">
                <div class="lg:col-span-4">
                    <div class="bg-white px-6 pt-6 pb-8 rounded-3xl shadow-xl border border-slate-100 h-fit">
                        <h2 class="text-lg font-bold mb-5 flex items-center gap-2">
                            <span class="w-2 h-6 bg-red-500 rounded-full"></span> ‡§ö‡•Ç‡§ï ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ
                        </h2>
                        <form id="wrongForm" class="space-y-4">
                            <input type="hidden" id="wrongEditId">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="wrongDateInput"
                                        class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï</label>
                                    <input type="date" id="wrongDateInput" required
                                        class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none">
                                </div>
                                <div>
                                    <label for="wrongTimeInput"
                                        class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§ï‡§æ‡§≤‡§æ‡§µ‡§ß‡•Ä</label>
                                    <input type="text" id="wrongTimeInput" required placeholder="HH:MM"
                                        class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none">
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑
                                    - ‡§è‡§ï‡§æ‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§®‡§ø‡§µ‡§°‡•Ç ‡§∂‡§ï‡§§‡§æ</label>

                                <div class="multi-select-container">
                                    <div id="doshTrigger"
                                        class="multi-select-trigger w-full rounded-xl border-slate-200 bg-slate-50 border focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none">
                                        <span class="multi-select-placeholder">‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑ ‡§®‡§ø‡§µ‡§°‡§æ...</span>
                                    </div>

                                    <div id="doshDropdown" class="multi-select-dropdown">
                                        <div class="multi-select-search">
                                            <input type="text" id="doshSearch" placeholder="üîç ‡§¶‡•ã‡§∑ ‡§∂‡•ã‡§ß‡§æ..."
                                                autocomplete="off">
                                        </div>

                                        <div class="multi-select-options" id="doshOptions">
                                            <div class="multi-select-group-label">‡§∑‡§°‡•ç‡§∞‡§ø‡§™‡•Ç
                                            </div>
                                            <div class="multi-select-option" data-value="Desire (Kama)"
                                                data-group="shadripu">
                                                <input type="checkbox" id="dosh_desire" value="‡§ï‡§æ‡§Æ (Desire)">
                                                <label for="dosh_desire">‡§ï‡§æ‡§Æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Anger (Krodha)"
                                                data-group="shadripu">
                                                <input type="checkbox" id="dosh_anger" value="‡§ï‡•ç‡§∞‡•ã‡§ß (Anger)">
                                                <label for="dosh_anger">‡§ï‡•ç‡§∞‡•ã‡§ß / ‡§∞‡§æ‡§ó</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Greed (Lobha)"
                                                data-group="shadripu">
                                                <input type="checkbox" id="dosh_greed" value="‡§≤‡•ã‡§≠ (Greed)">
                                                <label for="dosh_greed">‡§≤‡•ã‡§≠</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Attachment (Moha)"
                                                data-group="shadripu">
                                                <input type="checkbox" id="dosh_attachment" value="‡§Æ‡•ã‡§π (Attachment)">
                                                <label for="dosh_attachment">‡§Æ‡•ã‡§π</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Arrogance (Mada)"
                                                data-group="shadripu">
                                                <input type="checkbox" id="dosh_arrogance"
                                                    value="‡§Æ‡§¶ / ‡§§‡§æ‡§†‡§æ (Arrogance)">
                                                <label for="dosh_arrogance">‡§Æ‡§¶ / ‡§§‡§æ‡§†‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Jealousy (Matsarya)"
                                                data-group="shadripu">
                                                <input type="checkbox" id="dosh_jealousy"
                                                    value="‡§Æ‡§§‡•ç‡§∏‡§∞ / ‡§¶‡•ç‡§µ‡•á‡§∑ (Jealousy)">
                                                <label for="dosh_jealousy">‡§Æ‡§§‡•ç‡§∏‡§∞ / ‡§¶‡•ç‡§µ‡•á‡§∑</label>
                                            </div>

                                            <div class="multi-select-group-label">‡§á‡§§‡§∞‡§æ‡§Ç‡§®‡§æ ‡§§‡•ç‡§∞‡§æ‡§∏‡§¶‡§æ‡§Ø‡§ï</div>
                                            <div class="multi-select-option" data-value="Short-tempered"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_shorttempered" value="Short-tempered">
                                                <label for="dosh_shorttempered">‡§∂‡•Ä‡§ò‡•ç‡§∞‡§ï‡•ã‡§™‡•Ä‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Irritable"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_irritable" value="Irritable">
                                                <label for="dosh_irritable">‡§ö‡§ø‡§°‡§ñ‡•ã‡§∞‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Quarrelsome"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_quarrelsome" value="Quarrelsome">
                                                <label for="dosh_quarrelsome">‡§≠‡§æ‡§Ç‡§°‡§ñ‡•ã‡§∞‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Destructive"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_destructive" value="Destructive">
                                                <label for="dosh_destructive">‡§µ‡§ø‡§ß‡•ç‡§µ‡§Ç‡§∏‡§ï‡§µ‡•É‡§§‡•ç‡§§‡•Ä</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Looking down upon others"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_lookingdown"
                                                    value="Looking down upon others">
                                                <label for="dosh_lookingdown">‡§¶‡•Å‡§∏‡§±‡•ç‡§Ø‡§æ‡§≤‡§æ ‡§§‡•Å‡§ö‡•ç‡§õ
                                                    ‡§≤‡•á‡§ñ‡§£‡•á</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Pointing mistakes of others"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_pointing"
                                                    value="Pointing mistakes of others">
                                                <label for="dosh_pointing">‡§á‡§§‡§∞‡§æ‡§Ç‡§ö‡•ç‡§Ø‡§æ ‡§ö‡•Å‡§ï‡§æ
                                                    ‡§∂‡•ã‡§ß‡§£‡•á</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Criticism"
                                                data-group="affecting-others">
                                                <input type="checkbox" id="dosh_criticism" value="Criticism">
                                                <label for="dosh_criticism">‡§ü‡•Ä‡§ï‡§æ ‡§ï‡§∞‡§£‡•á</label>
                                            </div>

                                            <div class="multi-select-group-label">‡§∏‡•ç‡§µ‡§§‡§É‡§∏‡§æ‡§†‡•Ä ‡§§‡•ç‡§∞‡§æ‡§∏‡§¶‡§æ‡§Ø‡§ï</div>
                                            <div class="multi-select-option" data-value="Egoistic"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_egoistic" value="Egoistic">
                                                <label for="dosh_egoistic">‡§Ö‡§π‡§Ç‡§ï‡§æ‡§∞ / ‡§ó‡§∞‡•ç‡§µ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Emotional"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_emotional" value="Emotional">
                                                <label for="dosh_emotional">‡§≠‡§æ‡§µ‡§µ‡§ø‡§µ‡§∂‡§§‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Fearful"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_fearful" value="Fearful">
                                                <label for="dosh_fearful">‡§≠‡•Ä‡§§‡•Ä</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Lying / Dishonesty"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_lying" value="Lying / Dishonesty">
                                                <label for="dosh_lying">‡§ñ‡•ã‡§ü‡•á ‡§¨‡•ã‡§≤‡§£‡•á /
                                                    ‡§Ö‡§™‡•ç‡§∞‡§æ‡§Æ‡§æ‡§£‡§ø‡§ï‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Suspicious"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_suspicious" value="Suspicious">
                                                <label for="dosh_suspicious">‡§∏‡§Ç‡§∂‡§Ø‡•Ä‡§µ‡•É‡§§‡•ç‡§§‡•Ä</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Ungrateful"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_ungrateful" value="Ungrateful">
                                                <label for="dosh_ungrateful">‡§ï‡•É‡§§‡§ò‡•ç‡§®‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="No repentance"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_norepentance" value="No repentance">
                                                <label for="dosh_norepentance">‡§™‡§∂‡•ç‡§ö‡§æ‡§§‡•ç‡§§‡§æ‡§™ ‡§®
                                                    ‡§π‡•ã‡§£‡•á</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Lack of seriousness"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_lackseriousness"
                                                    value="Lack of seriousness">
                                                <label for="dosh_lackseriousness">‡§ó‡§æ‡§Ç‡§≠‡•Ä‡§∞‡•ç‡§Ø‡§æ‡§ö‡§æ
                                                    ‡§Ö‡§≠‡§æ‡§µ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Lack of planning"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_lackplanning" value="Lack of planning">
                                                <label for="dosh_lackplanning">‡§®‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ‡§ö‡§æ ‡§Ö‡§≠‡§æ‡§µ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Forgetful"
                                                data-group="affecting-self">
                                                <input type="checkbox" id="dosh_forgetful" value="Forgetful">
                                                <label for="dosh_forgetful">‡§µ‡§ø‡§∏‡§∞‡§≠‡•ã‡§≥‡•á‡§™‡§£‡§æ</label>
                                            </div>

                                            <div class="multi-select-group-label">‡§ï‡•É‡§§‡•Ä ‡§Ü‡§£‡§ø ‡§µ‡§∞‡•ç‡§§‡§®</div>
                                            <div class="multi-select-option" data-value="Laziness"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_laziness" value="Laziness">
                                                <label for="dosh_laziness">‡§Ü‡§≥‡§∏</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Hasty" data-group="behavioral">
                                                <input type="checkbox" id="dosh_hasty" value="Hasty">
                                                <label for="dosh_hasty">‡§ò‡§æ‡§à‡§ò‡§æ‡§à‡§®‡•á ‡§ï‡§∞‡§£‡•á /
                                                    ‡§â‡§§‡§æ‡§µ‡§≥‡•á‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Carelessness"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_carelessness" value="Carelessness">
                                                <label for="dosh_carelessness">‡§®‡§ø‡§∑‡•ç‡§ï‡§æ‡§≥‡§ú‡•Ä‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Irresponsible"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_irresponsible" value="Irresponsible">
                                                <label for="dosh_irresponsible">‡§¨‡•á‡§ú‡§¨‡§æ‡§¨‡§¶‡§æ‡§∞‡§™‡§£‡§æ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Disobedience"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_disobedience" value="Disobedience">
                                                <label for="dosh_disobedience">‡§Ö‡§µ‡§ú‡•ç‡§û‡§æ ‡§ï‡§∞‡§£‡•á</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Talking unnecessarily"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_talking" value="Talking unnecessarily">
                                                <label for="dosh_talking">‡§µ‡§ø‡§®‡§æ‡§ï‡§æ‡§∞‡§£ ‡§¨‡•ã‡§≤‡§£‡•á</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Narrow-mindedness"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_narrowminded" value="Narrow-mindedness">
                                                <label for="dosh_narrowminded">‡§∏‡§Ç‡§ï‡•Å‡§ö‡§ø‡§§‡§µ‡•É‡§§‡•ç‡§§‡•Ä</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Poor decision making"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_poordecision"
                                                    value="Poor decision making">
                                                <label for="dosh_poordecision">‡§®‡§ø‡§∞‡•ç‡§£‡§Ø‡§ï‡•ç‡§∑‡§Æ‡§§‡•á‡§ö‡§æ
                                                    ‡§Ö‡§≠‡§æ‡§µ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Lacking confidence"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_lackconfidence"
                                                    value="Lacking confidence">
                                                <label for="dosh_lackconfidence">‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏‡§æ‡§ö‡§æ
                                                    ‡§Ö‡§≠‡§æ‡§µ</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Overspending"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_overspending" value="Overspending">
                                                <label for="dosh_overspending">‡§â‡§ß‡§≥‡§™‡§ü‡•ç‡§ü‡•Ä</label>
                                            </div>
                                            <div class="multi-select-option" data-value="Not systematic"
                                                data-group="behavioral">
                                                <input type="checkbox" id="dosh_notsystematic" value="Not systematic">
                                                <label for="dosh_notsystematic">‡§Ö‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§‡§™‡§£‡§æ</label>
                                            </div>

                                            <div class="multi-select-option" data-value="Others" data-group="other">
                                                <input type="checkbox" id="dosh_others" value="‡§á‡§§‡§∞ (Others)">
                                                <label for="dosh_others">‡§á‡§§‡§∞</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-[10px] text-slate-500 mt-1.5 italic">üí° ‡§â‡§ò‡§°‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ ‡§Ü‡§£‡§ø ‡§¶‡•ã‡§∑
                                    ‡§®‡§ø‡§µ‡§°‡§æ</p>
                            </div>
                            <div>
                                <label for="wrongClassificationInput"
                                    class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§µ‡§∞‡•ç‡§ó‡§ø‡§ï‡§∞‡§£
                                </label>
                                <select id="wrongClassificationInput"
                                    class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border text-sm focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none">
                                    <option value="">‡§µ‡§∞‡•ç‡§ó‡§ø‡§ï‡§∞‡§£ ‡§®‡§ø‡§µ‡§°‡§æ...</option>
                                    <option value="‡§∏‡•ç‡§µ‡§§:">‡§∏‡•ç‡§µ‡§§:</option>
                                    <option value="‡§∏‡§æ‡§ß‡§ï">‡§∏‡§æ‡§ß‡§ï</option>
                                    <option value="‡§á‡§§‡§∞">‡§á‡§§‡§∞</option>
                                </select>
                            </div>
                            <div>
                                <label for="wrongThingsInput"
                                    class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§™‡•ç‡§∞‡§∏‡§Ç‡§ó /
                                    ‡§µ‡§∞‡•ç‡§£‡§®</label>
                                <textarea id="wrongThingsInput" required placeholder="‡§™‡•ç‡§∞‡§∏‡§Ç‡§ó‡§æ‡§ö‡•á ‡§µ‡§∞‡•ç‡§£‡§® ‡§≤‡§ø‡§π‡§æ..."
                                    class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border h-32 resize-none focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none"></textarea>
                            </div>
                            <button type="submit" id="wrongSubmitBtn"
                                class="w-full bg-slate-900 text-white py-4 rounded-xl hover:bg-red-600 font-bold shadow-lg transition-all hover:-translate-y-1 active:scale-95 mt-2">‡§ö‡•Ç‡§ï
                                ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ</button>
                        </form>
                    </div>
                </div>
                <div class="lg:col-span-8">
                    <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                        <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                            <span class="font-bold text-slate-800">‡§Æ‡§æ‡§ó‡•Ä‡§≤ ‡§®‡•ã‡§Ç‡§¶‡•Ä</span>
                            <div class="relative w-48">
                                <input type="text" id="searchWrongLogs" placeholder="‡§∂‡•ã‡§ß‡§æ..."
                                    class="w-full pl-8 pr-3 py-1.5 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-200">
                                <svg class="w-3.5 h-3.5 text-slate-400 absolute left-2.5 top-2" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <tbody id="wrongTableBody" class="divide-y divide-slate-50"></tbody>
                            </table>
                            <div id="wrongEmpty" class="hidden p-20 text-center text-slate-600 italic">‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§ï‡§æ‡§π‡•Ä‡§π‡•Ä
                                ‡§®‡•ã‡§Ç‡§¶ ‡§®‡§æ‡§π‡•Ä.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DECISION PAGE -->
        <div id="page-decision" class="page-content max-w-6xl mx-auto px-4 py-8">
            <header class="mb-8">
                <h2 class="text-2xl font-extrabold tracking-tight text-slate-900 notranslate">‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø</h2>
                <p class="text-slate-600 text-sm">‡§ú‡§æ‡§£‡•Ä‡§µ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ö‡•Å‡§ï‡§æ ‡§∏‡•Å‡§ß‡§æ‡§∞‡§£‡•á</p>
            </header>
            <div class="grid lg:grid-cols-12 gap-8">
                <div class="lg:col-span-5">
                    <div class="bg-white px-6 pt-6 pb-8 rounded-3xl shadow-xl border border-slate-100 h-fit">
                        <h2 class="text-lg font-bold mb-5 flex items-center gap-2"><span
                                class="w-2 h-6 bg-blue-600 rounded-full"></span> ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ</h2>
                        <form id="decisionForm" class="space-y-4">
                            <input type="hidden" id="decisionEditId">
                            <div>
                                <label for="wrongThingSelector"
                                    class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§ö‡•Ç‡§ï ‡§®‡§ø‡§µ‡§°‡§æ</label>
                                <div class="custom-select-container relative">
                                    <div id="wrongThingTrigger"
                                        class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border font-medium text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none flex justify-between items-center cursor-pointer min-h-[46px]">
                                        <span class="text-slate-500">-- ‡§Æ‡§æ‡§ó‡•Ä‡§≤ ‡§®‡•ã‡§Ç‡§¶‡•Ä‡§Æ‡§ß‡•Ç‡§® ‡§®‡§ø‡§µ‡§°‡§æ --</span>
                                        <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7"></path>
                                        </svg>
                                    </div>
                                    <input type="hidden" id="wrongThingSelector" required>

                                    <div id="wrongThingDropdown"
                                        class="hidden absolute z-20 w-full mt-1 bg-white border border-slate-100 rounded-xl shadow-xl max-h-60 overflow-y-auto">
                                        <div class="p-2 sticky top-0 bg-white border-b border-slate-50">
                                            <input type="text" id="wrongThingSearch" placeholder="‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§∂‡•ã‡§ß‡§æ..."
                                                class="w-full p-2 text-xs bg-slate-50 rounded-lg border-none outline-none focus:ring-1 focus:ring-blue-500">
                                        </div>
                                        <div id="wrongThingOptions" class="py-1">
                                            <!-- Options populated by JS -->
                                        </div>
                                    </div>
                                </div>
                                <div id="wrongThingPreview" class="hidden"></div>
                            </div>
                            <div>
                                <label for="decisionInput"
                                    class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø /
                                    ‡§¶‡•É‡§∑‡•ç‡§ü‡•Ä‡§ï‡•ã‡§®</label>
                                <textarea id="decisionInput" required
                                    placeholder="‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§¶‡•É‡§∑‡•ç‡§ü‡•Ä‡§ï‡•ã‡§® / ‡§ï‡•É‡§§‡•Ä ‡§ï‡§æ‡§Ø ‡§Ö‡§∏‡§æ‡§Ø‡§≤‡§æ ‡§π‡§µ‡•Ä?"
                                    class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border h-32 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none"></textarea>
                            </div>
                            <button type="submit" id="decisionSubmitBtn"
                                class="w-full bg-blue-600 text-white py-4 rounded-xl hover:bg-blue-700 font-bold shadow-lg transition-all hover:-translate-y-1 active:scale-95 mt-2">‡§®‡§ø‡§∞‡•ç‡§£‡§Ø
                                ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ</button>
                        </form>
                    </div>
                </div>
                <div class="lg:col-span-7">
                    <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                        <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                            <span class="font-bold text-slate-800">‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡•Ç‡§ö‡•Ä</span>
                            <div class="relative w-48">
                                <input type="text" id="searchDecisionLogs" placeholder="‡§∂‡•ã‡§ß‡§æ..."
                                    class="w-full pl-8 pr-3 py-1.5 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-200">
                                <svg class="w-3.5 h-3.5 text-slate-400 absolute left-2.5 top-2" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <tbody id="decisionTableBody" class="divide-y divide-slate-50"></tbody>
                            </table>
                            <div id="decisionEmpty" class="hidden p-20 text-center text-slate-600 italic">‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§ï‡•ã‡§£‡§§‡§æ‡§π‡•Ä
                                ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESULTS PAGE -->
        <div id="page-results" class="page-content max-w-6xl mx-auto px-4 py-8">
            <header class="mb-8">
                <h2 class="text-2xl font-extrabold tracking-tight text-slate-900 notranslate">‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§Ü‡§£‡§ø ‡§¨‡§¶‡§≤</h2>
                <p class="text-slate-600 text-sm">‡§ï‡•É‡§§‡•Ä‡§®‡§Ç‡§§‡§∞ ‡§ù‡§æ‡§≤‡•á‡§≤‡•á ‡§Ö‡§Ç‡§§‡§∞‡•ç‡§ó‡§§ ‡§¨‡§¶‡§≤ ‡§Ö‡§®‡•Å‡§≠‡§µ‡§£‡•á</p>
            </header>
            <div class="grid lg:grid-cols-12 gap-8">
                <div class="lg:col-span-5">
                    <div class="bg-white px-6 pt-6 pb-8 rounded-3xl shadow-xl border border-slate-100 h-fit">
                        <h2 class="text-lg font-bold mb-5 flex items-center gap-2"><span
                                class="w-2 h-6 bg-emerald-500 rounded-full"></span> ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ</h2>
                        <form id="resultForm" class="space-y-4">
                            <input type="hidden" id="resultEditId">
                            <div>
                                <label for="decisionSelector"
                                    class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§ò‡•á‡§§‡§≤‡•á‡§≤‡§æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø
                                    ‡§®‡§ø‡§µ‡§°‡§æ</label>
                                <select id="decisionSelector" required
                                    class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border font-medium text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none">
                                    <option value="">-- ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø‡§æ‡§Ç‡§Æ‡§ß‡•Ç‡§® ‡§®‡§ø‡§µ‡§°‡§æ --</option>
                                </select>
                            </div>
                            <div>
                                <label for="resultInput"
                                    class="block text-xs font-bold text-slate-600 uppercase mb-1.5">‡§¶‡§ø‡§∏‡•Ç‡§® ‡§Ü‡§≤‡•á‡§≤‡§æ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ /
                                    ‡§¨‡§¶‡§≤</label>
                                <textarea id="resultInput" required
                                    placeholder="‡§®‡§ø‡§∞‡•ç‡§£‡§Ø‡§æ‡§µ‡§∞ ‡§ï‡•É‡§§‡•Ä ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ‡§®‡§Ç‡§§‡§∞ ‡§ï‡§æ‡§Ø ‡§¨‡§¶‡§≤ ‡§ú‡§æ‡§£‡§µ‡§≤‡•á?"
                                    class="w-full rounded-xl border-slate-200 bg-slate-50 p-3 border h-32 resize-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 outline-none"></textarea>
                            </div>
                            <button type="submit" id="resultSubmitBtn"
                                class="w-full bg-emerald-600 text-white py-4 rounded-xl hover:bg-emerald-700 font-bold shadow-lg transition-all hover:-translate-y-1 active:scale-95 mt-2">‡§™‡§∞‡§ø‡§£‡§æ‡§Æ
                                ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ</button>
                        </form>
                    </div>
                </div>
                <div class="lg:col-span-7">
                    <div class="bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                        <div class="p-6 border-b border-slate-50 flex justify-between items-center">
                            <span class="font-bold text-slate-800">‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§™‡•ç‡§∞‡§µ‡§æ‡§∏</span>
                            <div class="relative w-48">
                                <input type="text" id="searchResultLogs" placeholder="‡§∂‡•ã‡§ß‡§æ..."
                                    class="w-full pl-8 pr-3 py-1.5 text-xs bg-slate-50 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-200">
                                <svg class="w-3.5 h-3.5 text-slate-400 absolute left-2.5 top-2" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <tbody id="resultsTableBody" class="divide-y divide-slate-50"></tbody>
                            </table>
                            <div id="resultsEmpty" class="hidden p-20 text-center text-slate-600 italic">‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ
                                ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="toast"
        class="fixed bottom-6 right-6 px-6 py-3 bg-slate-900 text-white rounded-2xl text-sm font-bold shadow-2xl opacity-0 transition-all translate-y-10 pointer-events-none z-[70]">
    </div>

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'mr',
                includedLanguages: 'en,hi,mr,gu,kn,ta',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" async
        src="https://translate.googleapis.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        const STORAGE_WRONG = 'ss_wrong_logs_v2';
        const STORAGE_DECISION = 'ss_decision_logs_v2';
        const STORAGE_RESULT = 'ss_result_logs_v2';
        const LANG_KEY = 'ss_preferred_lang';

        let wrongLogs = JSON.parse(localStorage.getItem(STORAGE_WRONG)) || [];
        let decisionLogs = JSON.parse(localStorage.getItem(STORAGE_DECISION)) || [];
        let resultLogs = JSON.parse(localStorage.getItem(STORAGE_RESULT)) || [];

        // --- Read More / Truncate Logic ---
        function getExpandableText(text, uidPrefix, limit = 100) {
            if (!text) return '';
            // Basic escaping to prevent XSS and ensure safe slicing
            const safeText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

            if (safeText.length <= limit) return safeText;

            const shortText = safeText.substring(0, limit) + '...';

            return `<span id="short-${uidPrefix}">${shortText}</span><span id="full-${uidPrefix}" class="hidden">${safeText}</span><button onclick="toggleReadMore('${uidPrefix}')" id="btn-${uidPrefix}" class="text-blue-600 text-xs font-bold hover:underline ml-1 focus:outline-none">‡§Ö‡§ß‡§ø‡§ï ‡§µ‡§æ‡§ö‡§æ</button>`;
        }

        window.toggleReadMore = (uid) => {
            const shortSpan = document.getElementById(`short-${uid}`);
            const fullSpan = document.getElementById(`full-${uid}`);
            const btn = document.getElementById(`btn-${uid}`);

            if (shortSpan.classList.contains('hidden')) {
                shortSpan.classList.remove('hidden');
                fullSpan.classList.add('hidden');
                btn.textContent = '‡§Ö‡§ß‡§ø‡§ï ‡§µ‡§æ‡§ö‡§æ';
            } else {
                shortSpan.classList.add('hidden');
                fullSpan.classList.remove('hidden');
                btn.textContent = '‡§ï‡§Æ‡•Ä ‡§ï‡§∞‡§æ';
            }
        };

        // --- Navigation Logic ---
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page-content');

        navLinks.forEach(link => {
            link.onclick = () => {
                const targetId = link.id.replace('nav-', 'page-');

                // Only act if tab changed
                if (document.getElementById(targetId).classList.contains('active')) return;

                navLinks.forEach(l => l.classList.remove('active-tab'));
                link.classList.add('active-tab');
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(targetId).classList.add('active');

                // On-demand rendering when switching tabs
                if (targetId === 'page-decision') {
                    populateWrongSelector();
                    renderDecisions();
                }
                if (targetId === 'page-results') {
                    populateDecisionSelector();
                    renderResults();
                }
            };
        });

        // --- Custom Multi-Select Dropdown Logic ---
        const doshTrigger = document.getElementById('doshTrigger');
        const doshDropdown = document.getElementById('doshDropdown');
        const doshSearch = document.getElementById('doshSearch');
        const doshOptions = document.querySelectorAll('.multi-select-option input[type="checkbox"]');
        let selectedDoshValues = [];

        // Toggle dropdown
        doshTrigger.onclick = (e) => {
            e.stopPropagation();
            doshDropdown.classList.toggle('active');
            if (doshDropdown.classList.contains('active')) {
                doshSearch.focus();
            }
        };

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!doshTrigger.contains(e.target) && !doshDropdown.contains(e.target)) {
                doshDropdown.classList.remove('active');
            }
        });

        // Search functionality
        doshSearch.oninput = (e) => {
            const searchTerm = e.target.value.toLowerCase();
            document.querySelectorAll('.multi-select-option').forEach(option => {
                const label = option.querySelector('label').textContent.toLowerCase();
                if (label.includes(searchTerm)) {
                    option.classList.remove('hidden');
                } else {
                    option.classList.add('hidden');
                }
            });
        };

        // Handle checkbox selection
        doshOptions.forEach(checkbox => {
            checkbox.onchange = () => {
                updateSelectedDosh();
                renderDoshBadges();
            };
        });

        function updateSelectedDosh() {
            selectedDoshValues = Array.from(doshOptions)
                .filter(cb => cb.checked)
                .map(cb => cb.value);
        }

        function renderDoshBadges() {
            const placeholder = doshTrigger.querySelector('.multi-select-placeholder');
            const badges = doshTrigger.querySelectorAll('.selected-badge');

            // Remove existing badges
            badges.forEach(badge => badge.remove());

            if (selectedDoshValues.length === 0) {
                if (!placeholder) {
                    const span = document.createElement('span');
                    span.className = 'multi-select-placeholder';
                    span.textContent = '‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑ ‡§®‡§ø‡§µ‡§°‡§æ...';
                    doshTrigger.appendChild(span);
                }
            } else {
                // Remove placeholder
                if (placeholder) placeholder.remove();

                // Add badges
                selectedDoshValues.forEach(value => {
                    const badge = document.createElement('span');
                    badge.className = 'selected-badge';
                    badge.innerHTML = `
                        ${value}
                        <button type="button" onclick="removeDosh('${value.replace(/'/g, "\\'")}')">√ó</button>
                    `;
                    doshTrigger.appendChild(badge);
                });
            }
        }

        window.removeDosh = (value) => {
            const checkbox = Array.from(doshOptions).find(cb => cb.value === value);
            if (checkbox) {
                checkbox.checked = false;
                updateSelectedDosh();
                renderDoshBadges();
            }
        };

        function getSelectedDosh() {
            return selectedDoshValues;
        }

        function setSelectedDosh(values) {
            // Uncheck all first
            doshOptions.forEach(cb => cb.checked = false);

            // Check the selected ones
            const valuesArray = Array.isArray(values) ? values : (values ? [values] : []);
            valuesArray.forEach(value => {
                const checkbox = Array.from(doshOptions).find(cb => cb.value === value);
                if (checkbox) checkbox.checked = true;
            });

            updateSelectedDosh();
            renderDoshBadges();
        }

        function clearDoshSelection() {
            doshOptions.forEach(cb => cb.checked = false);
            selectedDoshValues = [];
            renderDoshBadges();
        }

        // --- Wrong Things Logic ---
        const wrongForm = document.getElementById('wrongForm');
        wrongForm.onsubmit = (e) => {
            e.preventDefault();
            const editId = document.getElementById('wrongEditId').value;
            const selectedDosh = getSelectedDosh(); // Use custom dropdown function

            if (selectedDosh.length === 0) {
                showToast("‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§ø‡§Æ‡§æ‡§® ‡§è‡§ï ‡§∏‡•ç‡§µ‡§≠‡§æ‡§µ ‡§¶‡•ã‡§∑ ‡§®‡§ø‡§µ‡§°‡§æ");
                return;
            }

            const data = {
                id: editId || Date.now().toString(),
                Date: document.getElementById('wrongDateInput').value,
                Time: document.getElementById('wrongTimeInput').value,
                Dosh: selectedDosh,
                Classification: document.getElementById('wrongClassificationInput').value,
                WrongThings: document.getElementById('wrongThingsInput').value
            };


            if (editId) {
                const index = wrongLogs.findIndex(l => l.id === editId);
                if (index !== -1) wrongLogs[index] = data;
                document.getElementById('wrongEditId').value = '';
                document.getElementById('wrongSubmitBtn').textContent = '‡§ö‡•Ç‡§ï ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ';
                showToast("‡§ö‡•Ç‡§ï ‡§∏‡•Å‡§ß‡§æ‡§∞‡§≤‡•Ä");
            } else {
                wrongLogs.push(data);
                showToast("‡§ö‡•Ç‡§ï ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•Ä");
            }

            localStorage.setItem(STORAGE_WRONG, JSON.stringify(wrongLogs));
            renderWrong();
            wrongForm.reset();
            clearDoshSelection(); // Clear custom dropdown
            const now = new Date();
            document.getElementById('wrongDateInput').valueAsDate = now;
            document.getElementById('wrongTimeInput').value = now.toTimeString().slice(0, 5);
            document.getElementById('wrongClassificationInput').value = '';
        };

        // Initialize Search Listeners
        document.getElementById('searchWrongLogs').addEventListener('input', () => renderWrong());
        document.getElementById('searchDecisionLogs').addEventListener('input', () => renderDecisions());
        document.getElementById('searchResultLogs').addEventListener('input', () => renderResults());

        function renderWrong(showAll = false) {
            const container = document.getElementById('wrongTableBody');
            const empty = document.getElementById('wrongEmpty');
            const searchTerm = document.getElementById('searchWrongLogs').value.toLowerCase();

            container.innerHTML = '';

            // Filter
            const filteredLogs = wrongLogs.filter(log => {
                if (!searchTerm) return true;
                if (!searchTerm) return true;
                const doshStr = Array.isArray(log.Dosh) ? log.Dosh.join(' ') : (log.Dosh || '');
                return log.WrongThings.toLowerCase().includes(searchTerm) ||
                    doshStr.toLowerCase().includes(searchTerm) ||
                    (log.Classification && log.Classification.toLowerCase().includes(searchTerm)) ||
                    log.Date.includes(searchTerm);
            });

            // Sort
            filteredLogs.sort((a, b) => {
                const valA = a.Date + (a.Time || '00:00');
                const valB = b.Date + (b.Time || '00:00');
                return valB.localeCompare(valA);
            });

            if (filteredLogs.length === 0) {
                empty.classList.remove('hidden');
                empty.textContent = searchTerm ? '‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§∏‡§æ‡§™‡§°‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä.' : '‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§ï‡§æ‡§π‡•Ä‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§®‡§æ‡§π‡•Ä.';
                return;
            }

            empty.classList.add('hidden');
            const displayLogs = showAll ? filteredLogs : filteredLogs.slice(0, 50);
            const fragment = document.createDocumentFragment();

            let lastDate = null;
            displayLogs.forEach(log => {
                // Add Date Header if date changes
                if (log.Date !== lastDate) {
                    const dateHeader = document.createElement('tr');
                    dateHeader.className = "bg-slate-50/50";
                    dateHeader.innerHTML = `<td colspan="3" class="px-6 py-2 text-[11px] font-bold text-slate-500 uppercase tracking-widest bg-slate-100/50 sticky top-0 backdrop-blur-sm shadow-sm">${log.Date}</td>`;
                    fragment.appendChild(dateHeader);
                    lastDate = log.Date;
                }

                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 border-b border-slate-50 group";

                // Handle both old single-value and new array format
                const doshArray = Array.isArray(log.Dosh) ? log.Dosh : (log.Dosh ? [log.Dosh] : []);
                const doshBadges = doshArray.length > 0
                    ? doshArray.map(d => `<span class="inline-block bg-red-100 text-red-700 px-2 py-0.5 rounded-full text-[9px] font-bold mr-1 mb-1 shadow-sm">${d}</span>`).join('')
                    : '<span class="text-slate-400 text-[10px]">Uncategorized</span>';

                tr.innerHTML = `<td class="px-2 md:px-6 py-3 md:py-4 w-16 md:w-20 align-top">
                        <div class="text-xs font-bold text-slate-700 font-mono bg-slate-100 inline-block px-1.5 py-0.5 rounded">${log.Time || '--:--'}</div>
                    </td>
                    <td class="px-2 md:px-6 py-3 md:py-4 align-top">
                        <div class="mb-2">
                            ${doshBadges}
                            ${log.Classification ? `<span class="inline-block bg-slate-200 text-slate-700 px-2 py-0.5 rounded-full text-[9px] font-bold mr-1 mb-1 shadow-sm border border-slate-300">${log.Classification}</span>` : ''}
                        </div>
                        <div class="text-sm text-slate-700 font-medium break-all whitespace-pre-wrap leading-relaxed">${getExpandableText(log.WrongThings, 'w-' + log.id)}</div>
                    </td>
                    <td class="px-2 md:px-6 py-3 md:py-4 text-right w-16 md:w-24 align-top">
                        <div class="flex justify-end gap-2 md:gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="editEntry('wrong', '${log.id}')" class="p-1.5 rounded-lg text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-all">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                            </button>
                            <button onclick="deleteEntry('wrong', '${log.id}')" class="p-1.5 rounded-lg text-slate-400 hover:text-red-600 hover:bg-red-50 transition-all">‚úï</button>
                        </div>
                    </td>`;
                fragment.appendChild(tr);
            });

            if (!showAll && wrongLogs.length > 50) {
                const moreTr = document.createElement('tr');
                moreTr.innerHTML = `<td colspan="3" class="px-6 py-4 text-center">
                    <button onclick="renderWrong(true)" class="text-blue-600 text-sm font-bold hover:underline">‡§Ü‡§£‡§ñ‡•Ä ${wrongLogs.length - 50} ‡§®‡•ã‡§Ç‡§¶‡•Ä ‡§¶‡§æ‡§ñ‡§µ‡§æ...</button>
                </td>`;
                fragment.appendChild(moreTr);
            }
            container.appendChild(fragment);
        }

        // --- Decision Logic ---
        const decisionForm = document.getElementById('decisionForm');
        // Custom Wrong Thing Dropdown Logic
        const wtTrigger = document.getElementById('wrongThingTrigger');
        const wtDropdown = document.getElementById('wrongThingDropdown');
        const wtInput = document.getElementById('wrongThingSelector');
        const wtSearch = document.getElementById('wrongThingSearch');

        wtTrigger.onclick = (e) => {
            e.stopPropagation();
            populateWrongSelector(); // Ensure up to date
            wtDropdown.classList.toggle('hidden');
            if (!wtDropdown.classList.contains('hidden')) {
                wtSearch.value = '';
                wtSearch.focus();
                // Reset search visibility
                const options = document.getElementById('wrongThingOptions').children;
                Array.from(options).forEach(opt => opt.classList.remove('hidden'));
            }
        };

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!wtTrigger.contains(e.target) && !wtDropdown.contains(e.target)) {
                wtDropdown.classList.add('hidden');
            }
        });

        wtSearch.oninput = (e) => {
            const term = e.target.value.toLowerCase();
            const options = document.getElementById('wrongThingOptions').children;
            Array.from(options).forEach(opt => {
                const text = opt.textContent.toLowerCase();
                if (text.includes(term)) opt.classList.remove('hidden');
                else opt.classList.add('hidden');
            });
        };

        function populateWrongSelector() {
            const container = document.getElementById('wrongThingOptions');
            container.innerHTML = '';

            if (wrongLogs.length === 0) {
                container.innerHTML = '<div class="p-3 text-xs text-slate-500 italic">‡§Ö‡§ú‡•Ç‡§® ‡§ï‡•ã‡§£‡§§‡•Ä‡§π‡•Ä ‡§ö‡•Ç‡§ï ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•Ä ‡§®‡§æ‡§π‡•Ä.</div>';
                return;
            }

            wrongLogs.forEach(log => {
                const div = document.createElement('div');
                div.className = 'px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 cursor-pointer border-b border-slate-50 last:border-0 whitespace-normal';
                div.innerHTML = `<span class="font-bold text-xs text-slate-500 block mb-1">[${log.Date}]</span> ${log.WrongThings}`;
                div.onclick = () => {
                    wtInput.value = log.id;
                    const span = wtTrigger.querySelector('span');
                    span.textContent = `[${log.Date}] ${log.WrongThings.substring(0, 50)}${log.WrongThings.length > 50 ? '...' : ''}`;
                    span.classList.remove('text-slate-500');
                    span.classList.add('text-slate-800');
                    wtDropdown.classList.add('hidden');
                    updateWrongPreview(log.id);
                };
                container.appendChild(div);
            });
        }

        decisionForm.onsubmit = (e) => {
            e.preventDefault();
            const editId = document.getElementById('decisionEditId').value;
            const wrongId = document.getElementById('wrongThingSelector').value;
            const wrongEntry = wrongLogs.find(l => l.id === wrongId);
            const data = {
                id: editId || Date.now().toString(),
                wrongId,
                wrongText: wrongEntry.WrongThings,
                decision: document.getElementById('decisionInput').value,
                date: new Date().toISOString().split('T')[0]
            };

            if (editId) {
                const index = decisionLogs.findIndex(l => l.id === editId);
                if (index !== -1) decisionLogs[index] = data;
                document.getElementById('decisionEditId').value = '';
                document.getElementById('decisionSubmitBtn').textContent = '‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ';
                showToast("‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡•Å‡§ß‡§æ‡§∞‡§≤‡§æ");
            } else {
                decisionLogs.push(data);
                showToast("‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡§æ");
            }

            localStorage.setItem(STORAGE_DECISION, JSON.stringify(decisionLogs));
            renderDecisions();
            decisionForm.reset();
            updateWrongPreview(null);
        };

        function updateWrongPreview(logId) {
            const preview = document.getElementById('wrongThingPreview');
            if (!logId) {
                preview.innerHTML = '';
                preview.classList.add('hidden');
                return;
            }
            const log = wrongLogs.find(l => l.id === logId);
            if (!log) {
                preview.classList.add('hidden');
                return;
            }

            const doshArray = Array.isArray(log.Dosh) ? log.Dosh : (log.Dosh ? [log.Dosh] : []);
            const doshBadges = doshArray.length > 0
                ? doshArray.map(d => `<span class="inline-block bg-red-100 text-red-700 px-2 py-0.5 rounded-full text-[9px] font-bold mr-1 mb-1 shadow-sm">${d}</span>`).join('')
                : '<span class="text-slate-400 text-[10px]">Uncategorized</span>';

            preview.innerHTML = `
                <div class="mt-4 p-4 bg-slate-50 rounded-2xl border border-slate-100 shadow-inner">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] text-slate-500 font-bold uppercase tracking-wider">‡§®‡§ø‡§µ‡§°‡§≤‡•á‡§≤‡•Ä ‡§ö‡•Ç‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä:</span>
                        <div class="text-[10px] font-mono text-slate-600 bg-white px-1.5 py-0.5 rounded border border-slate-100 flex gap-2">
                             <span>üìÖ ${log.Date}</span>
                             <span>‚è∞ ${log.Time || '--:--'}</span>
                        </div>
                    </div>
                    <div class="mb-2 flex flex-wrap">${doshBadges}</div>
                    <p class="text-xs text-slate-600 italic leading-relaxed break-all whitespace-pre-wrap border-l-2 border-red-200 pl-3">"${log.WrongThings}"</p>
                </div>
            `;
            preview.classList.remove('hidden');
        }

        function renderDecisions(showAll = false) {
            const container = document.getElementById('decisionTableBody');
            const empty = document.getElementById('decisionEmpty');
            const searchTerm = document.getElementById('searchDecisionLogs').value.toLowerCase();

            container.innerHTML = '';

            // Filter
            const filteredLogs = decisionLogs.filter(log => {
                if (!searchTerm) return true;
                return log.decision.toLowerCase().includes(searchTerm) ||
                    (log.wrongText && log.wrongText.toLowerCase().includes(searchTerm));
            });

            // Sort (Newest Date First)
            filteredLogs.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

            if (filteredLogs.length === 0) {
                empty.classList.remove('hidden');
                empty.textContent = searchTerm ? '‡§ï‡•ã‡§£‡§§‡§æ‡§π‡•Ä ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§∏‡§æ‡§™‡§°‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.' : '‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§ï‡•ã‡§£‡§§‡§æ‡§π‡•Ä ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä.';
                return;
            }

            empty.classList.add('hidden');
            const displayLogs = showAll ? filteredLogs : filteredLogs.slice(0, 50);
            const fragment = document.createDocumentFragment();

            let lastDate = null;
            displayLogs.forEach(log => {
                if (log.date !== lastDate) {
                    const dateHeader = document.createElement('tr');
                    dateHeader.className = "bg-slate-50/50";
                    dateHeader.innerHTML = `<td colspan="2" class="px-6 py-2 text-[11px] font-bold text-slate-500 uppercase tracking-widest bg-slate-100/50 sticky top-0">${log.date || '‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä'}</td>`;
                    fragment.appendChild(dateHeader);
                    lastDate = log.date;
                }

                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 border-b border-slate-50 group";

                // Find original Dosh for context
                const originalWrong = wrongLogs.find(w => w.id === log.wrongId);
                const doshArray = originalWrong ? (Array.isArray(originalWrong.Dosh) ? originalWrong.Dosh : [originalWrong.Dosh]) : [];
                const doshBadges = doshArray.length > 0
                    ? doshArray.map(d => `<span class="inline-block bg-red-50 text-red-600 border border-red-100 px-1.5 py-0.5 rounded text-[8px] font-bold mr-1 italic">${d}</span>`).join('')
                    : '';

                tr.innerHTML = `<td class="px-2 md:px-6 py-3 md:py-4 align-top">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-[10px] text-red-600 uppercase font-bold">‡§Æ‡•Ç‡§≥ ‡§ö‡•Ç‡§ï:</span>
                        <div class="flex flex-wrap">${doshBadges}</div>
                    </div>
                    <div class="text-xs text-slate-600 italic mb-3 pl-3 border-l-2 border-red-100 break-all whitespace-pre-wrap leading-relaxed">"${log.wrongText}"</div>
                    
                    <div class="text-[10px] text-blue-600 uppercase font-bold mb-1">‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø:</div>
                    <div class="text-sm font-medium text-slate-800 break-all whitespace-pre-wrap leading-relaxed">${getExpandableText(log.decision, 'd-' + log.id)}</div>
                </td>
                <td class="px-2 md:px-6 py-3 md:py-4 text-right w-16 md:w-24 align-top">
                    <div class="flex justify-end gap-2 md:gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="editEntry('decision', '${log.id}')" class="p-1.5 rounded-lg text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-all">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        </button>
                        <button onclick="deleteEntry('decision', '${log.id}')" class="p-1.5 rounded-lg text-slate-400 hover:text-red-600 hover:bg-red-50 transition-all">‚úï</button>
                    </div>
                </td>`;
                fragment.appendChild(tr);
            });

            if (!showAll && decisionLogs.length > 50) {
                const moreTr = document.createElement('tr');
                moreTr.innerHTML = `<td colspan="2" class="px-6 py-4 text-center">
                    <button onclick="renderDecisions(true)" class="text-blue-600 text-sm font-bold hover:underline">‡§∏‡§∞‡•ç‡§µ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§¶‡§æ‡§ñ‡§µ‡§æ...</button>
                </td>`;
                fragment.appendChild(moreTr);
            }
            container.appendChild(fragment);
        }

        // --- Results Logic ---
        const resultForm = document.getElementById('resultForm');
        function populateDecisionSelector() {
            const sel = document.getElementById('decisionSelector');
            const val = sel.value;
            sel.innerHTML = '<option value="">-- ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø‡§æ‡§Ç‡§Æ‡§ß‡•Ç‡§® ‡§®‡§ø‡§µ‡§°‡§æ --</option>';
            decisionLogs.forEach(log => {
                const opt = document.createElement('option');
                opt.value = log.id;
                opt.textContent = log.decision;
                sel.appendChild(opt);
            });
            sel.value = val;
        }

        resultForm.onsubmit = (e) => {
            e.preventDefault();
            const editId = document.getElementById('resultEditId').value;
            const decisionId = document.getElementById('decisionSelector').value;
            const decisionEntry = decisionLogs.find(l => l.id === decisionId);
            const data = {
                id: editId || Date.now().toString(),
                decisionId,
                decisionText: decisionEntry.decision,
                result: document.getElementById('resultInput').value,
                date: new Date().toISOString().split('T')[0]
            };

            if (editId) {
                const index = resultLogs.findIndex(l => l.id === editId);
                if (index !== -1) resultLogs[index] = data;
                document.getElementById('resultEditId').value = '';
                document.getElementById('resultSubmitBtn').textContent = '‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§ú‡§§‡§® ‡§ï‡§∞‡§æ';
                showToast("‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•á‡§≤‡§æ");
            } else {
                resultLogs.push(data);
                showToast("‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡§æ");
            }

            localStorage.setItem(STORAGE_RESULT, JSON.stringify(resultLogs));
            renderResults();
            resultForm.reset();
        };

        function renderResults(showAll = false) {
            const container = document.getElementById('resultsTableBody');
            const empty = document.getElementById('resultsEmpty');
            const searchTerm = document.getElementById('searchResultLogs').value.toLowerCase();

            container.innerHTML = '';

            // Filter
            const filteredLogs = resultLogs.filter(log => {
                if (!searchTerm) return true;
                return log.result.toLowerCase().includes(searchTerm) ||
                    (log.decisionText && log.decisionText.toLowerCase().includes(searchTerm));
            });

            // Sort (Newest Date First)
            filteredLogs.sort((a, b) => (b.date || '').localeCompare(a.date || ''));

            if (filteredLogs.length === 0) {
                empty.classList.remove('hidden');
                empty.textContent = searchTerm ? '‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§∏‡§æ‡§™‡§°‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.' : '‡§Ö‡§¶‡•ç‡§Ø‡§æ‡§™ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§≤‡•á ‡§®‡§æ‡§π‡•Ä‡§§.';
                return;
            }

            empty.classList.add('hidden');
            const displayLogs = showAll ? filteredLogs : filteredLogs.slice(0, 50);
            const fragment = document.createDocumentFragment();

            let lastDate = null;
            displayLogs.forEach(log => {
                if (log.date !== lastDate) {
                    const dateHeader = document.createElement('tr');
                    dateHeader.className = "bg-slate-50/50";
                    dateHeader.innerHTML = `<td colspan="2" class="px-6 py-2 text-[11px] font-bold text-slate-500 uppercase tracking-widest bg-slate-100/50 sticky top-0">${log.date || '‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä'}</td>`;
                    fragment.appendChild(dateHeader);
                    lastDate = log.date;
                }

                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 border-b border-slate-50 group";

                // Find original Dosh for context
                const decEntry = decisionLogs.find(d => d.id === log.decisionId);
                const originalWrong = decEntry ? wrongLogs.find(w => w.id === decEntry.wrongId) : null;
                const doshArray = originalWrong ? (Array.isArray(originalWrong.Dosh) ? originalWrong.Dosh : [originalWrong.Dosh]) : [];
                const doshBadges = doshArray.length > 0
                    ? doshArray.map(d => `<span class="inline-block bg-blue-50 text-blue-600 border border-blue-100 px-1.5 py-0.5 rounded text-[8px] font-bold mr-1 italic">${d}</span>`).join('')
                    : '';

                tr.innerHTML = `<td class="px-2 md:px-6 py-3 md:py-4 align-top">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-[10px] text-blue-600 uppercase font-bold">‡§Æ‡•Ç‡§≥ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø:</span>
                        <div class="flex flex-wrap">${doshBadges}</div>
                    </div>
                    <div class="text-xs text-slate-600 italic mb-3 pl-3 border-l-2 border-blue-100 break-all whitespace-pre-wrap leading-relaxed">"${log.decisionText}"</div>
                    
                    <div class="text-[10px] text-emerald-600 uppercase font-bold mb-1">‡§™‡§∞‡§ø‡§£‡§æ‡§Æ / ‡§¨‡§¶‡§≤:</div>
                    <div class="text-sm font-bold text-emerald-700 break-all whitespace-pre-wrap leading-relaxed">${getExpandableText(log.result, 'r-' + log.id)}</div>
                </td>
                <td class="px-2 md:px-6 py-3 md:py-4 text-right w-16 md:w-24 align-top">
                    <div class="flex justify-end gap-2 md:gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="editEntry('result', '${log.id}')" class="p-1.5 rounded-lg text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-all">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                        </button>
                        <button onclick="deleteEntry('result', '${log.id}')" class="p-1.5 rounded-lg text-slate-400 hover:text-red-600 hover:bg-red-50 transition-all">‚úï</button>
                    </div>
                </td>`;
                fragment.appendChild(tr);
            });

            if (!showAll && resultLogs.length > 50) {
                const moreTr = document.createElement('tr');
                moreTr.innerHTML = `<td colspan="2" class="px-6 py-4 text-center">
                    <button onclick="renderResults(true)" class="text-blue-600 text-sm font-bold hover:underline">‡§∏‡§∞‡•ç‡§µ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¶‡§æ‡§ñ‡§µ‡§æ...</button>
                </td>`;
                fragment.appendChild(moreTr);
            }
            container.appendChild(fragment);
        }

        // --- General ---
        window.editEntry = (type, id) => {
            if (type === 'wrong') {
                const log = wrongLogs.find(l => l.id === id);
                if (!log) return;
                document.getElementById('wrongEditId').value = log.id;
                document.getElementById('wrongDateInput').value = log.Date;
                document.getElementById('wrongTimeInput').value = log.Time;

                // Handle multi-select restoration with custom dropdown
                const doshArray = Array.isArray(log.Dosh) ? log.Dosh : (log.Dosh ? [log.Dosh] : []);
                setSelectedDosh(doshArray); // Use custom dropdown function

                document.getElementById('wrongClassificationInput').value = log.Classification || '';
                document.getElementById('wrongThingsInput').value = log.WrongThings;
                document.getElementById('wrongSubmitBtn').textContent = '‡§ö‡•Ç‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§æ';
                document.getElementById('page-wrong').scrollIntoView({ behavior: 'smooth' });
            } else if (type === 'decision') {
                const log = decisionLogs.find(l => l.id === id);
                if (!log) return;
                document.getElementById('decisionEditId').value = log.id;
                populateWrongSelector();
                document.getElementById('wrongThingSelector').value = log.wrongId;

                // Update trigger text for custom dropdown
                const wrongEntry = wrongLogs.find(w => w.id === log.wrongId);
                if (wrongEntry) {
                    const span = document.getElementById('wrongThingTrigger').querySelector('span');
                    span.textContent = `[${wrongEntry.Date}] ${wrongEntry.WrongThings.substring(0, 50)}...`;
                    span.classList.remove('text-slate-500');
                    span.classList.add('text-slate-800');
                }

                document.getElementById('decisionInput').value = log.decision;
                document.getElementById('decisionSubmitBtn').textContent = '‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§æ';
                updateWrongPreview(log.wrongId);
                document.getElementById('page-decision').scrollIntoView({ behavior: 'smooth' });
            } else if (type === 'result') {
                const log = resultLogs.find(l => l.id === id);
                if (!log) return;
                document.getElementById('resultEditId').value = log.id;
                populateDecisionSelector();
                document.getElementById('decisionSelector').value = log.decisionId;
                document.getElementById('resultInput').value = log.result;
                document.getElementById('resultSubmitBtn').textContent = '‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§æ';
                document.getElementById('page-results').scrollIntoView({ behavior: 'smooth' });
            }
        };

        window.deleteEntry = (type, id) => {
            if (!confirm("‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§Ü‡§π‡•á, ‡§π‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§°‡§ø‡§≤‡•Ä‡§ü ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•Ä ‡§Ü‡§π‡•á?")) return;
            if (type === 'wrong') {
                wrongLogs = wrongLogs.filter(l => l.id !== id);
                localStorage.setItem(STORAGE_WRONG, JSON.stringify(wrongLogs));
                renderWrong();
            } else if (type === 'decision') {
                decisionLogs = decisionLogs.filter(l => l.id !== id);
                localStorage.setItem(STORAGE_DECISION, JSON.stringify(decisionLogs));
                renderDecisions();
            } else {
                resultLogs = resultLogs.filter(l => l.id !== id);
                localStorage.setItem(STORAGE_RESULT, JSON.stringify(resultLogs));
                renderResults();
            }
        };

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.replace('opacity-0', 'opacity-100');
            t.classList.replace('translate-y-10', 'translate-y-0');
            setTimeout(() => {
                t.classList.replace('opacity-100', 'opacity-0');
                t.classList.replace('translate-y-0', 'translate-y-10');
            }, 3000);
        }

        document.getElementById('exportAllBtn').onclick = async () => {
            if (typeof XLSX === 'undefined') {
                showToast("‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§á‡§Ç‡§ú‡§ø‡§® ‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...");
                try {
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = "https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js";
                        script.onload = resolve;
                        script.onerror = () => reject(new Error("Failed to load XLSX library"));
                        document.head.appendChild(script);
                    });
                } catch (err) {
                    showToast("‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§≤‡§æ‡§Ø‡§¨‡•ç‡§∞‡§∞‡•Ä ‡§≤‡•ã‡§° ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏ ‡§Ö‡§ï‡•ç‡§∑‡§Æ.");
                    return;
                }
            }

            // 1. Create Consolidated Master Sheet (Mistake -> Decision -> Result)
            const consolidatedData = [];
            wrongLogs.forEach(mistake => {
                const mistakesDecisions = decisionLogs.filter(d => d.wrongId === mistake.id);

                if (mistakesDecisions.length === 0) {
                    const doshStr = Array.isArray(mistake.Dosh) ? mistake.Dosh.join(', ') : (mistake.Dosh || "-");
                    consolidatedData.push({
                        "Date": mistake.Date,
                        "Time": mistake.Time,
                        "Dosh": doshStr,
                        "Mistake Description": mistake.WrongThings,
                        "Right Decision": "Pending",
                        "Outcome/Change": "Pending"
                    });
                } else {
                    mistakesDecisions.forEach(decision => {
                        const decisionResults = resultLogs.filter(r => r.decisionId === decision.id);

                        if (decisionResults.length === 0) {
                            const doshStr = Array.isArray(mistake.Dosh) ? mistake.Dosh.join(', ') : (mistake.Dosh || "-");
                            consolidatedData.push({
                                "Date": mistake.Date,
                                "Time": mistake.Time,
                                "Dosh": doshStr,
                                "Mistake Description": mistake.WrongThings,
                                "Right Decision": decision.decision,
                                "Outcome/Change": "Pending"
                            });
                        } else {
                            decisionResults.forEach(res => {
                                const doshStr = Array.isArray(mistake.Dosh) ? mistake.Dosh.join(', ') : (mistake.Dosh || "-");
                                consolidatedData.push({
                                    "Date": mistake.Date,
                                    "Time": mistake.Time,
                                    "Dosh": doshStr,
                                    "Mistake Description": mistake.WrongThings,
                                    "Right Decision": decision.decision,
                                    "Outcome/Change": res.result
                                });
                            });
                        }
                    });
                }
            });

            // 2. Individual Section Mappings
            const exportMistakes = wrongLogs.map(l => {
                const doshStr = Array.isArray(l.Dosh) ? l.Dosh.join(', ') : (l.Dosh || "-");
                return {
                    "Date": l.Date,
                    "Time": l.Time,
                    "Dosh": doshStr,
                    "Mistake Description": l.WrongThings
                };
            });

            const exportDecisions = decisionLogs.map(l => ({
                "Original Mistake": l.wrongText,
                "Right Decision": l.decision,
                "Date Logged": l.date
            }));

            const exportResults = resultLogs.map(l => ({
                "Applied Decision": l.decisionText,
                "Outcome / Change": l.result,
                "Date Logged": l.date
            }));

            const wb = XLSX.utils.book_new();

            // Add Master Sheet first
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(consolidatedData), "Master Journey Log");

            // Then individual sheets
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(exportMistakes), "1-All Mistakes History");
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(exportDecisions), "2-All Decisions Taken");
            XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(exportResults), "3-All Transformation Results");

            // Download the file
            XLSX.writeFile(wb, "Sanatan_Sanstha_Audit_Complete.xlsx");
            showToast("‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§è‡§ï‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ù‡§æ‡§≤‡•Ä!");
        };

        const modal = document.getElementById('settingsModal');
        document.getElementById('menuBtn').onclick = () => modal.classList.remove('hidden');
        document.getElementById('closeModal').onclick = () => modal.classList.add('hidden');
        document.getElementById('modalOverlay').onclick = () => modal.classList.add('hidden');

        document.getElementById('langSelect').onchange = (e) => {
            const googleSelect = document.querySelector('.goog-te-combo');
            if (googleSelect) {
                googleSelect.value = e.target.value;
                googleSelect.dispatchEvent(new Event('change', { bubbles: true }));
                localStorage.setItem(LANG_KEY, e.target.value);
                showToast("‡§≠‡§æ‡§∑‡§æ ‡§¨‡§¶‡§≤‡§≤‡•Ä");
                modal.classList.add('hidden');
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const now = new Date();
            document.getElementById('wrongDateInput').valueAsDate = now;
            document.getElementById('wrongTimeInput').value = now.toTimeString().slice(0, 5);

            // Initial render for active page only to improve TTI
            renderWrong();

            // Defer other renders to keep main thread free during initialization
            setTimeout(() => {
                renderDecisions();
                renderResults();
                initTranslate();
            }, 500);
        });

        function initTranslate() {
            const savedLang = localStorage.getItem(LANG_KEY);
            if (savedLang) {
                document.getElementById('langSelect').value = savedLang;
                const check = setInterval(() => {
                    const sel = document.querySelector('.goog-te-combo');
                    if (sel) {
                        sel.value = savedLang;
                        sel.dispatchEvent(new Event('change', { bubbles: true }));
                        clearInterval(check);
                    }
                }, 100);
                setTimeout(() => clearInterval(check), 5000);
            }
        }

        // --- Background Music Logic ---
        const audio = document.getElementById('bgMusic');
        const audioBtn = document.getElementById('audioBtn');
        const audioLabel = document.getElementById('audioLabel');
        const iconMuted = document.getElementById('icon-muted');
        const iconPlaying = document.getElementById('icon-playing');
        let isPlaying = false;

        function updateAudioUI(playing) {
            if (playing) {
                iconMuted.classList.add('hidden');
                iconPlaying.classList.remove('hidden');
                audioBtn.classList.add('bg-orange-100');
                audioLabel.classList.add('animate-pulse');
            } else {
                iconPlaying.classList.add('hidden');
                iconMuted.classList.remove('hidden');
                audioBtn.classList.remove('bg-orange-100');
                audioLabel.classList.remove('animate-pulse');
            }
            isPlaying = playing;
        }

        function toggleAudio() {
            if (isPlaying) {
                audio.pause();
                updateAudioUI(false);
            } else {
                audio.play().then(() => {
                    updateAudioUI(true);
                }).catch(err => {
                    console.log("Playback failed:", err);
                    updateAudioUI(false);
                });
            }
        }

        // Attempt autoplay sequence
        function tryAutoplay() {
            audio.play().then(() => {
                // Autoplay worked!
                updateAudioUI(true);
            }).catch(error => {
                console.log("Autoplay prevented. Waiting for user interaction.");
                // Autoplay blocked. Add one-time click listener to body to start it.
                document.addEventListener('click', function unlockAudio() {
                    audio.play().then(() => {
                        updateAudioUI(true);
                    }).catch(e => console.log("Still prevented: " + e));
                    // Remove listener after first interaction
                    document.removeEventListener('click', unlockAudio);
                }, { once: true });
            });
        }

        audioBtn.onclick = (e) => {
            e.stopPropagation(); // Prevent triggering the document unlocking listener if clicked directly
            toggleAudio();
        };

        // Initialize
        tryAutoplay();
    </script>
</body>

</html>